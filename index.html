<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Seminar Iulian Perpelici 6 Dan, BucureÈ™ti - Mirai Dojo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            overflow-x: hidden;
            max-width: 100%;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            overflow-x: hidden;
        }

        header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(220, 38, 38, 0.3);
            border: 2px solid #dc2626;
            margin-bottom: 30px;
            text-align: center;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
            position: relative;
        }

        .header-logo {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            max-height: 120px;
            width: auto;
            opacity: 0.95;
            transition: opacity 0.3s ease;
        }

        .header-logo:hover {
            opacity: 1;
        }

        h1 {
            color: #ffffff;
            font-size: 2.5em;
            margin-bottom: 10px;
            line-height: 1.3;
            text-shadow: 2px 2px 4px rgba(220, 38, 38, 0.5);
        }

        h1 .title-line1 {
            display: block;
            font-size: 1em;
        }

        h1 .title-line2 {
            display: block;
            font-size: 0.75em;
            margin-top: 10px;
            color: #dc2626;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            color: #d1d5db;
            font-size: 1.2em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .stats-grid:last-of-type {
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .stats-grid.single-card {
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        #dashboard-tab {
            padding-top: 32px;
            padding-left: 20px;
            padding-right: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stats-grid.stats-grid-4 {
            grid-template-columns: repeat(4, minmax(200px, 1fr));
            max-width: 1200px;
            width: 100%;
            margin: 0 auto 28px auto;
            gap: 24px;
        }

        .stats-grid.dashboard-antrenament {
            max-width: 1200px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 28px;
        }

        .stat-card.total-card {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            box-shadow: 0 10px 30px rgba(220, 38, 38, 0.5);
            border: 2px solid #dc2626;
        }

        .stat-card.total-card .stat-number {
            color: white;
            -webkit-text-fill-color: white;
            font-size: 4em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .stat-card.total-card .stat-label {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.3em;
            font-weight: 600;
        }

        .stat-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
            border: 1px solid #dc2626;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.5);
        }

        .stat-card .card-chart {
            height: 140px;
            position: relative;
            margin-top: 10px;
            width: 100%;
        }

        .stat-card .card-chart canvas {
            max-height: 140px !important;
            width: 100% !important;
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #d1d5db;
            font-size: 1.1em;
            margin-top: 10px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            margin-bottom: 30px;
        }

        .chart-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
            border: 1px solid #dc2626;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .chart-title {
            font-size: 1.5em;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(220, 38, 38, 0.5);
        }

        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
            max-width: 100%;
        }

        .chart-container canvas {
            max-width: 100% !important;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        footer {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
            border: 1px solid #dc2626;
            text-align: center;
            color: #d1d5db;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #dc2626;
        }

        .tab {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #d1d5db;
            border: 1px solid #dc2626;
            border-bottom: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            color: #ffffff;
        }

        .tab.active {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            box-shadow: 0 -3px 10px rgba(220, 38, 38, 0.3);
        }

        .tab-content {
            display: none !important;
        }

        .tab-content.active {
            display: block !important;
        }

        #dashboard-tab.active {
            display: flex !important;
        }

        /* Tab-urile de listÄƒ: conÈ›inut full width, doar tabel (listÄƒ), fÄƒrÄƒ carduri dashboard */
        #participants-tab.active,
        #listaparticipanti-tab.active {
            display: block !important;
            width: 100%;
            padding: 20px;
        }

        #participants-tab .participants-table-container,
        #listaparticipanti-tab .participants-table-container {
            display: block !important;
            visibility: visible !important;
        }

        /* Tabel participanÈ›i (doar Ã®n tab-urile Lista ÃŽnscriÈ™i / Lista ParticipanÈ›i, fÄƒrÄƒ stil de card dashboard) */
        .participants-table-container {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #374151;
            overflow-x: auto;
        }

        .participants-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .participants-table th {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #991b1b;
        }

        .participants-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #374151;
            color: #d1d5db;
        }

        .participants-table tr:hover {
            background: rgba(220, 38, 38, 0.1);
        }

        .participants-table tr:last-child td {
            border-bottom: none;
        }

        .table-search {
            width: 100%;
            padding: 12px;
            background: #2d2d2d;
            border: 1px solid #dc2626;
            border-radius: 8px;
            color: #d1d5db;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .table-search::placeholder {
            color: #9ca3af;
        }

        .table-info {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .sync-btn {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            border: 2px solid #dc2626;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.5);
            transition: all 0.3s ease;
        }

        .sync-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(220, 38, 38, 0.7);
            background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%);
        }

        .sync-btn:active {
            transform: translateY(0);
        }

        .sync-btn.loading {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            cursor: wait;
            border-color: #dc2626;
        }

        @media (max-width: 768px) {
            html, body {
                overflow-x: hidden;
                max-width: 100vw;
                width: 100%;
            }

            body {
                padding: 10px;
            }

            .container {
                padding: 0;
                width: 100%;
                max-width: 100%;
            }

            .charts-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .stat-number {
                font-size: 2.2em;
            }

            h1 .title-line1 {
                font-size: 1.3rem;
            }
            
            h1 .title-line2 {
                font-size: 0.95rem;
            }

            header {
                padding: 15px 10px;
                margin-bottom: 15px;
            }

            .header-logo {
                position: static;
                transform: none;
                max-height: 80px;
                margin: 15px auto 0;
                display: block;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 10px;
                margin-bottom: 15px;
                width: 100%;
                max-width: 100%;
            }

            #dashboard-tab {
                padding-top: 24px;
                padding-left: 12px;
                padding-right: 12px;
            }

            .stats-grid.stats-grid-4 {
                grid-template-columns: repeat(2, 1fr);
                max-width: 100%;
                gap: 16px;
            }

            .stat-card {
                padding: 15px 8px;
                width: 100%;
                max-width: 100%;
            }

            .stat-card .card-chart {
                height: 115px;
                margin-top: 6px;
            }

            .stat-label {
                font-size: 0.85rem;
            }

            .charts-grid {
                grid-template-columns: 1fr !important;
                gap: 15px;
                width: 100%;
                max-width: 100%;
            }

            .chart-card {
                width: 100%;
                max-width: 100%;
                overflow: hidden;
            }

            .chart-container {
                width: 100% !important;
                max-width: 100% !important;
            }

            .chart-card {
                min-height: 280px;
                padding: 12px;
                margin-bottom: 0;
            }

            .chart-title {
                font-size: 0.95rem;
                margin-bottom: 8px;
                padding: 0;
            }

            .chart-container {
                height: 230px !important;
            }

            .sync-btn {
                font-size: 0.85rem;
                padding: 10px 18px;
                width: 100%;
                max-width: 300px;
            }

            footer {
                padding: 15px 10px;
                font-size: 0.85rem;
            }

            .tabs {
                gap: 5px;
            }

            .tab {
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            .participants-table th,
            .participants-table td {
                padding: 10px 8px;
                font-size: 0.85rem;
            }

            .table-search {
                font-size: 0.85rem;
            }
        }

        /* Extra responsiveness for charts */
        @media (max-width: 480px) {
            html, body {
                overflow-x: hidden !important;
                max-width: 100vw !important;
                width: 100% !important;
            }

            body {
                padding: 5px;
            }

            .container {
                width: 100% !important;
                max-width: 100% !important;
                padding: 0 !important;
            }

            h1 .title-line1 {
                font-size: 1.1rem;
            }
            
            h1 .title-line2 {
                font-size: 0.85rem;
            }

            header {
                padding: 12px 8px;
            }

            .header-logo {
                max-height: 60px;
                margin-top: 10px;
            }

            .subtitle {
                font-size: 0.8rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
                gap: 5px;
                width: 100% !important;
                max-width: 100% !important;
            }

            .stat-card {
                padding: 10px 5px;
                width: 100% !important;
                max-width: 100% !important;
            }

            .stat-card.total-card .stat-number {
                font-size: 2.5em;
            }

            .stat-number {
                font-size: 1.8em;
            }

            .stat-label {
                font-size: 0.75rem;
            }

            .chart-card {
                min-height: 260px;
                padding: 8px;
                width: 100% !important;
                max-width: 100% !important;
                overflow: hidden !important;
            }

            .chart-title {
                font-size: 0.85rem;
                margin-bottom: 5px;
            }

            .chart-container {
                height: 210px !important;
                width: 100% !important;
                max-width: 100% !important;
            }

            .charts-grid {
                width: 100% !important;
                max-width: 100% !important;
                gap: 8px;
            }

            .sync-btn {
                font-size: 0.8rem;
                padding: 10px 15px;
            }

            .tab {
                padding: 8px 12px;
                font-size: 0.75rem;
            }

            .participants-table th,
            .participants-table td {
                padding: 8px 5px;
                font-size: 0.75rem;
            }

            .participants-table-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span class="title-line1">ðŸ“Š Dashboard Seminar Iulian Perpelici 6 Dan</span>
                <span class="title-line2">BucureÈ™ti - Mirai Dojo</span>
            </h1>
            <p class="subtitle">AnalizÄƒ completÄƒ a Ã®nregistrÄƒrilor pentru eveniment</p>
            <p class="subtitle" id="lastSyncInfo" style="font-size: 0.9em; margin-top: 5px; color: #9ca3af;"></p>
            <button class="sync-btn" onclick="syncData()" id="syncBtn">
                ðŸ”„ Sync din Google Sheets
            </button>
            <img src="logo-mirai-dojo.png" alt="Mirai Dojo Logo" class="header-logo">
        </header>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <div class="tab active" data-tab="dashboard" onclick="switchTab('dashboard')">ðŸ“Š Dashboard</div>
            <div class="tab" data-tab="participants" onclick="switchTab('participants')">ðŸ‘¥ Lista ÃŽnscriÈ™i</div>
            <div class="tab" data-tab="listaparticipanti" onclick="switchTab('listaparticipanti')">âœ… Lista ParticipanÈ›i</div>
        </div>

        <!-- Tab Content: Dashboard -->
        <div id="dashboard-tab" class="tab-content active">
        <div class="stats-grid stats-grid-4">
            <div class="stat-card" style="border-color: #0f9d58;">
                <div class="stat-label" style="margin-bottom: 8px; font-weight: 600; color: #9ca3af;">ÃŽnscriÈ™i vs ParticipanÈ›i</div>
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <div class="stat-number" id="inscrisi" style="color: #0f9d58; -webkit-text-fill-color: #0f9d58; font-size: 1.8rem;">0</div>
                        <div class="stat-label">ÃŽnscriÈ™i</div>
                    </div>
                    <div style="width: 2px; height: 40px; background: #374151;"></div>
                    <div>
                        <div class="stat-number" id="auParticipat" style="color: #0f9d58; -webkit-text-fill-color: #0f9d58; font-size: 1.8rem;">0</div>
                        <div class="stat-label">ParticipanÈ›i</div>
                    </div>
                </div>
                <div class="card-chart"><canvas id="chartInscrisiParticipanti"></canvas></div>
            </div>
            <div class="stat-card" style="border-color: #6366f1;">
                <div class="stat-label" style="margin-bottom: 8px; font-weight: 600; color: #9ca3af;">FRAA vs Alte organizaÈ›ii</div>
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <div class="stat-number" id="fraaCount" style="color: #6366f1; -webkit-text-fill-color: #6366f1; font-size: 1.8rem;">0</div>
                        <div class="stat-label">FRAA</div>
                    </div>
                    <div style="width: 2px; height: 40px; background: #374151;"></div>
                    <div>
                        <div class="stat-number" id="alteOrganizatiiCount" style="color: #6366f1; -webkit-text-fill-color: #6366f1; font-size: 1.8rem;">0</div>
                        <div class="stat-label">Alte organizaÈ›ii</div>
                    </div>
                </div>
                <div class="card-chart"><canvas id="chartFraaAlte"></canvas></div>
            </div>
            <div class="stat-card" style="border-color: #eab308;">
                <div class="stat-label" style="margin-bottom: 8px; font-weight: 600; color: #9ca3af;">Copil vs Adult</div>
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <div class="stat-number" id="copilListaCount" style="color: #eab308; -webkit-text-fill-color: #eab308; font-size: 1.8rem;">0</div>
                        <div class="stat-label">Copil</div>
                    </div>
                    <div style="width: 2px; height: 40px; background: #374151;"></div>
                    <div>
                        <div class="stat-number" id="adultListaCount" style="color: #eab308; -webkit-text-fill-color: #eab308; font-size: 1.8rem;">0</div>
                        <div class="stat-label">Adult</div>
                    </div>
                </div>
                <div class="card-chart"><canvas id="chartCopilAdult"></canvas></div>
            </div>
            <div class="stat-card" style="border-color: #ec4899;">
                <div class="stat-label" style="margin-bottom: 8px; font-weight: 600; color: #9ca3af;">Mudansha vs Yudansha</div>
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <div class="stat-number" id="mudanshaListaCount" style="color: #ec4899; -webkit-text-fill-color: #ec4899; font-size: 1.8rem;">0</div>
                        <div class="stat-label">Mudansha</div>
                    </div>
                    <div style="width: 2px; height: 40px; background: #374151;"></div>
                    <div>
                        <div class="stat-number" id="yudanshaListaCount" style="color: #ec4899; -webkit-text-fill-color: #ec4899; font-size: 1.8rem;">0</div>
                        <div class="stat-label">Yudansha</div>
                    </div>
                </div>
                <div class="card-chart"><canvas id="chartMudanshaYudansha"></canvas></div>
            </div>
        </div>
        <div class="stats-grid dashboard-antrenament">
            <div class="stat-card">
                <div class="stat-number" id="antrenament1">0</div>
                <div class="stat-label">ParticipanÈ›i antrenament 1</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="antrenament2">0</div>
                <div class="stat-label">ParticipanÈ›i antrenament 2</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="antrenament3">0</div>
                <div class="stat-label">ParticipanÈ›i antrenament 3</div>
            </div>
        </div>

        <div class="charts-grid" style="grid-template-columns: 1fr; max-width: 1200px; margin: 20px auto;">
            <div class="chart-card full-width">
                <h2 class="chart-title">ParticipanÈ›i pe antrenamente</h2>
                <div class="chart-container"><canvas id="chartAntrenamente"></canvas></div>
            </div>
            <div class="chart-card full-width">
                <h2 class="chart-title">Dojo-uri participante</h2>
                <div class="chart-container"><canvas id="chartDojoParticipanti"></canvas></div>
            </div>
        </div>

        </div>
        <!-- End Dashboard Tab -->

        <!-- Tab Content: Lista ÃŽnscriÈ™i -->
        <div id="participants-tab" class="tab-content">
            <div class="participants-table-container">
                <h2 style="color: #ffffff; margin-bottom: 15px; text-align: center;">ðŸ“‹ Lista CompletÄƒ ÃŽnscriÈ™i</h2>
                <input type="text" id="searchInput" class="table-search" placeholder="ðŸ” CautÄƒ participant (nume, dojo, organizaÈ›ie...)">
                <div class="table-info" id="tableInfo">Se Ã®ncarcÄƒ Ã®nscriÈ™ii...</div>
                <table class="participants-table" id="participantsTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nume Complet</th>
                            <th>Dojo</th>
                            <th>OrganizaÈ›ie</th>
                            <th>Categorie</th>
                            <th>Grad</th>
                        </tr>
                    </thead>
                    <tbody id="participantsTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">
                                ApasÄƒ butonul "Sync" pentru a Ã®ncÄƒrca Ã®nscriÈ™ii
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- End Lista ÃŽnscriÈ™i Tab -->

        <!-- Tab Content: Lista ParticipanÈ›i (nume din 1372261625 col A, date din 87508598 col B) -->
        <div id="listaparticipanti-tab" class="tab-content">
            <div class="participants-table-container">
                <h2 style="color: #ffffff; margin-bottom: 15px; text-align: center;">âœ… Lista ParticipanÈ›i (unici)</h2>
                <input type="text" id="searchParticipanti" class="table-search" placeholder="ðŸ” CautÄƒ (nume, dojo, organizaÈ›ie, categorie, grad...)">
                <div class="table-info" id="tableInfoParticipanti">Se Ã®ncarcÄƒ participanÈ›ii...</div>
                <table class="participants-table" id="participantiTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nume</th>
                            <th>Dojo</th>
                            <th>OrganizaÈ›ie</th>
                            <th>Copil / Adult</th>
                            <th>Grad</th>
                        </tr>
                    </thead>
                    <tbody id="participantiTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">
                                ApasÄƒ "Sync" pentru a Ã®ncÄƒrca lista participanÈ›ilor
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- End Lista ParticipanÈ›i Tab -->

        <footer>
            <p>Dashboard generat automat din datele Form Responses 1</p>
            <p>Ultima actualizare: <strong id="lastUpdate"></strong></p>
        </footer>
    </div>

    <script>
        // SeteazÄƒ data ultimei actualizÄƒri
        document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ro-RO');

        // Plugin Chart.js: numere pe grafice + trend pe bar
        if (typeof Chart !== 'undefined') {
            Chart.register({
                id: 'customDatalabels',
                afterDatasetsDraw: function(chart) {
                    var ctx = chart.ctx;
                    var data = chart.data.datasets[0].data;
                    var total = data.reduce(function(a, b) { return a + b; }, 0);
                    if (chart.config.type === 'doughnut') {
                        var meta = chart.getDatasetMeta(0);
                        meta.data.forEach(function(arc, i) {
                            var midAngle = (arc.startAngle + arc.endAngle) / 2;
                            var r = (arc.outerRadius + arc.innerRadius) / 2;
                            var x = arc.x + Math.cos(midAngle) * r;
                            var y = arc.y + Math.sin(midAngle) * r;
                            var val = data[i];
                            var pct = total > 0 ? Math.round(100 * val / total) + '%' : '0%';
                            ctx.save();
                            ctx.fillStyle = '#fff';
                            ctx.font = 'bold 14px sans-serif';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.fillText(val, x, y - 6);
                            ctx.font = '11px sans-serif';
                            ctx.fillStyle = '#d1d5db';
                            ctx.fillText(pct, x, y + 8);
                            ctx.restore();
                        });
                    }
                    if (chart.config.type === 'bar') {
                        var meta = chart.getDatasetMeta(0);
                        var isHorizontal = chart.options.indexAxis === 'y';
                        meta.data.forEach(function(bar, i) {
                            var val = data[i];
                            ctx.save();
                            ctx.fillStyle = '#fff';
                            ctx.font = 'bold 14px sans-serif';
                            if (isHorizontal) {
                                ctx.textAlign = 'left';
                                ctx.textBaseline = 'middle';
                                ctx.fillText(val, (bar.x > bar.base ? bar.x : bar.base) + 6, bar.y);
                            } else {
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'bottom';
                                ctx.fillText(val, bar.x, bar.y - 4);
                            }
                            ctx.restore();
                        });
                        var opts = chart.options.plugins;
                        if (opts && opts.trendLine && data.length === 3 && meta.data.length === 3) {
                            var a1 = data[0], a2 = data[1], a3 = data[2];
                            var n = 3, sumX = 3, sumY = a1 + a2 + a3, sumXY = a2 + 2*a3, sumX2 = 5;
                            var m = (sumXY - sumX * sumY / n) / (sumX2 - sumX * sumX / n);
                            var b = sumY / n - m * (sumX / n);
                            var trendY = [b, m + b, 2*m + b];
                            var scaleY = chart.scales.y;
                            var x0 = meta.data[0].x, x1 = meta.data[2].x;
                            var y0 = scaleY.getPixelForValue(trendY[0]), y1 = scaleY.getPixelForValue(trendY[2]);
                            ctx.save();
                            ctx.strokeStyle = 'rgba(34, 197, 94, 0.9)';
                            ctx.lineWidth = 2;
                            ctx.setLineDash([4, 4]);
                            ctx.beginPath();
                            ctx.moveTo(x0, y0);
                            ctx.lineTo(x1, y1);
                            ctx.stroke();
                            ctx.restore();
                            ctx.save();
                            ctx.fillStyle = '#22c55e';
                            ctx.font = '11px sans-serif';
                            ctx.textAlign = 'right';
                            ctx.fillText((m >= 0 ? 'â†— ' : 'â†˜ ') + (m >= 0 ? '+' : '') + m.toFixed(1) + ' trend', chart.chartArea.right - 4, chart.chartArea.top + 12);
                            ctx.restore();
                        }
                    }
                }
            });
        }

        // ConfiguraÈ›ie culori
        const colors = {
            primary: ['#dc2626', '#ef4444', '#f87171', '#991b1b', '#b91c1c', '#7f1d1d', '#fca5a5', '#dc2626'],
            copilAdult: ['#dc2626', '#4b5563'],
            mirai: ['#dc2626', '#1a1a1a'],
        };

        // Variabile globale pentru grafice È™i date
        let allParticipants = [];
        let listParticipanti = [];
        let chartInscrisiParticipanti, chartFraaAlte, chartCopilAdult, chartMudanshaYudansha, chartAntrenamente, chartDojoParticipanti;

        // Date default pentru grafice
        const defaultData = {
            total: 37,
            copilAdult: { 'Adult': 32, 'Copil': 5 },
            grade: { 'Mudansha (grad Kyu)': 22, 'Yudansha (grad Dan)': 15 },
            dojos: {
                'Mirai Dojo': 14,
                'Dumkan Dojo': 14,
                'Raijin dojo': 6,
                'Aikido Aikikai Constanta': 2,
                'Aikido Mangalia': 1
            },
            organizatii: { 'Asociatia Dumkan': 20, 'FRAA': 17 },
            participare: { 'Toate antrenamentele': 30, 'Sesiuni specifice': 7 },
            inscrisi: 0,
            auParticipat: 0,
            fraa: 0,
            alteOrganizatii: 0,
            copilLista: 0,
            adultLista: 0,
            mudanshaLista: 0,
            yudanshaLista: 0,
            antrenament1: 0,
            antrenament2: 0,
            antrenament3: 0,
            dojosParticipanti: {}
        };

        // ÃŽncearcÄƒ sÄƒ Ã®ncarci date din localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('dashboardData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.inscrisi === undefined) data.inscrisi = 0;
                    if (data.auParticipat === undefined) data.auParticipat = 0;
                    if (data.fraa === undefined) data.fraa = 0;
                    if (data.alteOrganizatii === undefined) data.alteOrganizatii = 0;
                    if (data.copilLista === undefined) data.copilLista = 0;
                    if (data.adultLista === undefined) data.adultLista = 0;
                    if (data.mudanshaLista === undefined) data.mudanshaLista = 0;
                    if (data.yudanshaLista === undefined) data.yudanshaLista = 0;
                    if (data.antrenament1 === undefined) data.antrenament1 = 0;
                    if (data.antrenament2 === undefined) data.antrenament2 = 0;
                    if (data.antrenament3 === undefined) data.antrenament3 = 0;
                    if (data.dojosParticipanti === undefined) data.dojosParticipanti = {};
                    return data;
                } catch (e) {
                    console.error('Eroare la parsarea datelor salvate:', e);
                    return defaultData;
                }
            }
            return defaultData;
        }

        // SalveazÄƒ datele Ã®n localStorage
        function saveData(stats) {
            localStorage.setItem('dashboardData', JSON.stringify(stats));
            localStorage.setItem('lastUpdate', new Date().toISOString());
            localStorage.setItem('participants', JSON.stringify(allParticipants));
            localStorage.setItem('listParticipanti', JSON.stringify(listParticipanti));
        }

        // ÃŽncarcÄƒ participanÈ›ii din localStorage
        function loadSavedParticipants() {
            const saved = localStorage.getItem('participants');
            if (saved) {
                try {
                    allParticipants = JSON.parse(saved);
                    populateParticipantsTable(allParticipants);
                    console.log(`ðŸ“‹ ParticipanÈ›i Ã®ncÄƒrcaÈ›i din cache: ${allParticipants.length}`);
                } catch (e) {
                    console.error('Eroare la Ã®ncÄƒrcarea participanÈ›ilor:', e);
                }
            }
        }

        // FuncÈ›ie pentru schimbarea Ã®ntre tabs (carduri doar pe Dashboard, listele pe tab-urile respective)
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(function(tab) {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(function(tab) {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) tab.classList.add('active');
            });
            var contentId = tabName === 'dashboard' ? 'dashboard-tab' : (tabName === 'participants' ? 'participants-tab' : 'listaparticipanti-tab');
            var el = document.getElementById(contentId);
            if (el) el.classList.add('active');
        }

        // FuncÈ›ie pentru popularea tabelului de participanÈ›i
        function populateParticipantsTable(participants) {
            const tbody = document.getElementById('participantsTableBody');
            const tableInfo = document.getElementById('tableInfo');
            
            if (!participants || participants.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">Nu existÄƒ Ã®nscriÈ™i</td></tr>';
                tableInfo.textContent = 'Nu existÄƒ date disponibile';
                return;
            }

            tbody.innerHTML = '';
            participants.forEach((p, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><strong>${p.nume}</strong></td>
                    <td>${p.dojo}</td>
                    <td>${p.organizatie}</td>
                    <td>${p.categorie}</td>
                    <td>${p.grad}</td>
                `;
                tbody.appendChild(row);
            });

            tableInfo.textContent = `Total: ${participants.length} Ã®nscriÈ™i`;
        }

        // FuncÈ›ie pentru popularea tabelei Lista ParticipanÈ›i
        function populateListaParticipantiTable(participanti) {
            const tbody = document.getElementById('participantiTableBody');
            const tableInfo = document.getElementById('tableInfoParticipanti');
            if (!participanti || participanti.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">Nu existÄƒ participanÈ›i sau apasÄƒ Sync.</td></tr>';
                tableInfo.textContent = '0 participanÈ›i';
                return;
            }
            tbody.innerHTML = '';
            participanti.forEach((p, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><strong>${p.nume}</strong></td>
                    <td>${p.dojo}</td>
                    <td>${p.organizatie}</td>
                    <td>${p.categorie}</td>
                    <td>${p.grad}</td>
                `;
                tbody.appendChild(row);
            });
            tableInfo.textContent = `Total: ${participanti.length} participanÈ›i unici`;
        }

        // FuncÈ›ie pentru cÄƒutare Ã®n tabel
        function setupTableSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = allParticipants.filter(p => {
                    return (
                        p.nume.toLowerCase().includes(searchTerm) ||
                        p.dojo.toLowerCase().includes(searchTerm) ||
                        p.organizatie.toLowerCase().includes(searchTerm) ||
                        p.categorie.toLowerCase().includes(searchTerm) ||
                        p.grad.toLowerCase().includes(searchTerm)
                    );
                });
                populateParticipantsTable(filtered);
            });
            const searchParticipanti = document.getElementById('searchParticipanti');
            searchParticipanti.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = listParticipanti.filter(p => {
                    return (
                        (p.nume || '').toLowerCase().includes(searchTerm) ||
                        (p.dojo || '').toLowerCase().includes(searchTerm) ||
                        (p.organizatie || '').toLowerCase().includes(searchTerm) ||
                        (p.categorie || '').toLowerCase().includes(searchTerm) ||
                        (p.grad || '').toLowerCase().includes(searchTerm)
                    );
                });
                populateListaParticipantiTable(filtered);
            });
        }

        // AnimaÈ›ie pentru numerele din carduri
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            const range = end - start;
            const increment = end > start ? 1 : -1;
            const stepTime = Math.abs(Math.floor(duration / range));
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                obj.textContent = current;
                if (current === end) {
                    clearInterval(timer);
                }
            }, stepTime);
        }

        // ActualizeazÄƒ cardurile cu datele salvate
        function updateCards(stats) {
            document.getElementById('inscrisi').textContent = stats.inscrisi ?? 0;
            document.getElementById('auParticipat').textContent = stats.auParticipat ?? 0;
            document.getElementById('fraaCount').textContent = stats.fraa ?? 0;
            document.getElementById('alteOrganizatiiCount').textContent = stats.alteOrganizatii ?? 0;
            document.getElementById('copilListaCount').textContent = stats.copilLista ?? 0;
            document.getElementById('adultListaCount').textContent = stats.adultLista ?? 0;
            document.getElementById('mudanshaListaCount').textContent = stats.mudanshaLista ?? 0;
            document.getElementById('yudanshaListaCount').textContent = stats.yudanshaLista ?? 0;
            document.getElementById('antrenament1').textContent = stats.antrenament1 ?? 0;
            document.getElementById('antrenament2').textContent = stats.antrenament2 ?? 0;
            document.getElementById('antrenament3').textContent = stats.antrenament3 ?? 0;
        }

        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { color: '#d1d5db', padding: 12 } },
                tooltip: { backgroundColor: 'rgba(0,0,0,0.8)', titleColor: '#fff', bodyColor: '#d1d5db' }
            }
        };

        function updateCharts(stats) {
            const s = stats || loadSavedData();
            // ÃŽnscriÈ™i vs ParticipanÈ›i
            const inscrisi = s.inscrisi ?? 0, participanti = s.auParticipat ?? 0;
            if (!chartInscrisiParticipanti) {
                chartInscrisiParticipanti = new Chart(document.getElementById('chartInscrisiParticipanti'), {
                    type: 'doughnut',
                    data: { labels: ['ÃŽnscriÈ™i', 'ParticipanÈ›i'], datasets: [{ data: [inscrisi, participanti], backgroundColor: ['#0f9d58', '#16c172'], borderWidth: 0, hoverOffset: 12 }] },
                    options: { ...chartOptions, cutout: '60%' }
                });
            } else {
                chartInscrisiParticipanti.data.datasets[0].data = [inscrisi, participanti];
                chartInscrisiParticipanti.update('active');
            }
            // FRAA vs Alte
            const fraa = s.fraa ?? 0, alte = s.alteOrganizatii ?? 0;
            if (!chartFraaAlte) {
                chartFraaAlte = new Chart(document.getElementById('chartFraaAlte'), {
                    type: 'doughnut',
                    data: { labels: ['FRAA', 'Alte organizaÈ›ii'], datasets: [{ data: [fraa, alte], backgroundColor: ['#6366f1', '#8b5cf6'], borderWidth: 0, hoverOffset: 12 }] },
                    options: { ...chartOptions, cutout: '60%' }
                });
            } else {
                chartFraaAlte.data.datasets[0].data = [fraa, alte];
                chartFraaAlte.update('active');
            }
            // Copil vs Adult
            const copil = s.copilLista ?? 0, adult = s.adultLista ?? 0;
            if (!chartCopilAdult) {
                chartCopilAdult = new Chart(document.getElementById('chartCopilAdult'), {
                    type: 'doughnut',
                    data: { labels: ['Copil', 'Adult'], datasets: [{ data: [copil, adult], backgroundColor: ['#eab308', '#4b5563'], borderWidth: 0, hoverOffset: 12 }] },
                    options: { ...chartOptions, cutout: '60%' }
                });
            } else {
                chartCopilAdult.data.datasets[0].data = [copil, adult];
                chartCopilAdult.update('active');
            }
            // Mudansha vs Yudansha
            const mudansha = s.mudanshaLista ?? 0, yudansha = s.yudanshaLista ?? 0;
            if (!chartMudanshaYudansha) {
                chartMudanshaYudansha = new Chart(document.getElementById('chartMudanshaYudansha'), {
                    type: 'doughnut',
                    data: { labels: ['Mudansha', 'Yudansha'], datasets: [{ data: [mudansha, yudansha], backgroundColor: ['#ec4899', '#f472b6'], borderWidth: 0, hoverOffset: 12 }] },
                    options: { ...chartOptions, cutout: '60%' }
                });
            } else {
                chartMudanshaYudansha.data.datasets[0].data = [mudansha, yudansha];
                chartMudanshaYudansha.update('active');
            }
            // Antrenament 1, 2, 3
            const a1 = s.antrenament1 ?? 0, a2 = s.antrenament2 ?? 0, a3 = s.antrenament3 ?? 0;
            if (!chartAntrenamente) {
                chartAntrenamente = new Chart(document.getElementById('chartAntrenamente'), {
                    type: 'bar',
                    data: {
                        labels: ['Antrenament 1', 'Antrenament 2', 'Antrenament 3'],
                        datasets: [{ label: 'ParticipanÈ›i', data: [a1, a2, a3], backgroundColor: ['#dc2626', '#ea580c', '#ca8a04'], borderWidth: 0, borderRadius: 8 }]
                    },
                    options: {
                        ...chartOptions,
                        plugins: {
                            ...chartOptions.plugins,
                            trendLine: true
                        },
                        scales: {
                            y: { beginAtZero: true, ticks: { color: '#d1d5db', stepSize: 1 }, grid: { color: 'rgba(255,255,255,0.06)' } },
                            x: { ticks: { color: '#d1d5db' }, grid: { display: false } }
                        }
                    }
                });
            } else {
                chartAntrenamente.data.datasets[0].data = [a1, a2, a3];
                chartAntrenamente.update('active');
            }
            // Dojo-uri participante (bar)
            var dojosPart = s.dojosParticipanti || {};
            var dojosSorted = Object.keys(dojosPart).map(function(k) { return [k, dojosPart[k]]; }).sort(function(a, b) { return b[1] - a[1]; });
            var dojoLabels = dojosSorted.length ? dojosSorted.map(function(x) { return x[0]; }) : ['â€”'];
            var dojoData = dojosSorted.length ? dojosSorted.map(function(x) { return x[1]; }) : [0];
            var dojoColors = colors.primary.concat(['#6b7280', '#4b5563', '#9ca3af', '#6366f1', '#8b5cf6']);
            if (!chartDojoParticipanti) {
                chartDojoParticipanti = new Chart(document.getElementById('chartDojoParticipanti'), {
                    type: 'bar',
                    data: {
                        labels: dojoLabels,
                        datasets: [{ label: 'ParticipanÈ›i', data: dojoData, backgroundColor: dojoColors.slice(0, dojoLabels.length), borderWidth: 0, borderRadius: 6 }]
                    },
                    options: {
                        ...chartOptions,
                        indexAxis: dojoLabels.length > 8 ? 'y' : 'x',
                        scales: {
                            y: { beginAtZero: true, ticks: { color: '#d1d5db', stepSize: 1 }, grid: { color: 'rgba(255,255,255,0.06)' } },
                            x: { ticks: { color: '#d1d5db', maxRotation: 45 }, grid: { display: false } }
                        }
                    }
                });
            } else {
                chartDojoParticipanti.data.labels = dojoLabels;
                chartDojoParticipanti.data.datasets[0].data = dojoData;
                chartDojoParticipanti.data.datasets[0].backgroundColor = dojoColors.slice(0, dojoLabels.length);
                chartDojoParticipanti.options.indexAxis = dojoLabels.length > 8 ? 'y' : 'x';
                chartDojoParticipanti.update('active');
            }
        }

        // ActualizeazÄƒ afiÈ™ajul ultimei sincronizÄƒri
        function updateLastSyncDisplay() {
            const lastUpdate = localStorage.getItem('lastUpdate');
            const syncInfo = document.getElementById('lastSyncInfo');
            if (lastUpdate) {
                const date = new Date(lastUpdate);
                syncInfo.textContent = `Ultima sincronizare: ${date.toLocaleString('ro-RO')}`;
                syncInfo.style.display = 'block';
            } else {
                syncInfo.style.display = 'none';
            }
        }

        // AnimeazÄƒ numerele la Ã®ncÄƒrcarea paginii cu datele salvate
        window.addEventListener('load', async () => {
            // SeteazÄƒ funcÈ›ia de search
            setupTableSearch();

            const lastUpdate = localStorage.getItem('lastUpdate');
            
            // DacÄƒ nu existÄƒ date salvate sau sunt mai vechi de 5 minute, fÄƒ sync automat
            if (!lastUpdate) {
                console.log('ðŸ”„ Prima Ã®ncÄƒrcare - se sincronizeazÄƒ automat datele...');
                await syncData();
            } else {
                // ÃŽncarcÄƒ datele salvate
                const stats = loadSavedData();
                document.getElementById('inscrisi').textContent = stats.inscrisi ?? 0;
                document.getElementById('auParticipat').textContent = stats.auParticipat ?? 0;
                document.getElementById('antrenament1').textContent = stats.antrenament1 ?? 0;
                document.getElementById('antrenament2').textContent = stats.antrenament2 ?? 0;
                document.getElementById('antrenament3').textContent = stats.antrenament3 ?? 0;

                // ÃŽncarcÄƒ participanÈ›ii salvaÈ›i
                loadSavedParticipants();
                const savedListPart = localStorage.getItem('listParticipanti');
                if (savedListPart) {
                    try {
                        listParticipanti = JSON.parse(savedListPart);
                        populateListaParticipantiTable(listParticipanti);
                        const fraa = listParticipanti.filter(p => (String(p.organizatie || '').toUpperCase().includes('FRAA'))).length;
                        document.getElementById('fraaCount').textContent = stats.fraa ?? fraa;
                        document.getElementById('alteOrganizatiiCount').textContent = stats.alteOrganizatii ?? (listParticipanti.length - fraa);
                        const copilL = listParticipanti.filter(p => (String(p.categorie || '').toUpperCase().includes('COPIL'))).length;
                        const adultL = listParticipanti.length - copilL;
                        const yudanshaL = listParticipanti.filter(p => {
                            const g = String(p.grad || '').toUpperCase();
                            return g.includes('YUDANSHA') || (g.includes('DAN') && !g.includes('MUDANSHA'));
                        }).length;
                        const mudanshaL = listParticipanti.length - yudanshaL;
                        document.getElementById('copilListaCount').textContent = stats.copilLista ?? copilL;
                        document.getElementById('adultListaCount').textContent = stats.adultLista ?? adultL;
                        document.getElementById('mudanshaListaCount').textContent = stats.mudanshaLista ?? mudanshaL;
                        document.getElementById('yudanshaListaCount').textContent = stats.yudanshaLista ?? yudanshaL;
                    } catch (e) { }
                } else {
                    document.getElementById('fraaCount').textContent = stats.fraa ?? 0;
                    document.getElementById('alteOrganizatiiCount').textContent = stats.alteOrganizatii ?? 0;
                    document.getElementById('copilListaCount').textContent = stats.copilLista ?? 0;
                    document.getElementById('adultListaCount').textContent = stats.adultLista ?? 0;
                    document.getElementById('mudanshaListaCount').textContent = stats.mudanshaLista ?? 0;
                    document.getElementById('yudanshaListaCount').textContent = stats.yudanshaLista ?? 0;
                }

                const date = new Date(lastUpdate);
                console.log(`ðŸ“Š Date Ã®ncÄƒrcate din ultima sincronizare: ${date.toLocaleString('ro-RO')}`);
                updateCharts(stats);
            }
            
            // AfiÈ™eazÄƒ data ultimei actualizÄƒri
            updateLastSyncDisplay();
        });

        // FuncÈ›ie pentru parsare CSV
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        // FuncÈ›ie pentru sync date din Google Sheets
        async function syncData() {
            const btn = document.getElementById('syncBtn');
            btn.textContent = 'â³ Se sincronizeazÄƒ...';
            btn.classList.add('loading');
            btn.disabled = true;

            try {
                const SPREADSHEET_ID = '1HzNmWMrqhrD5uXejIS2pPUGxNJi-5gxiDU2pn7wxC1E';
                const SHEET_GID = '87508598';
                
                // ÃŽncearcÄƒ mai multe metode de descÄƒrcare
                let csvText = null;
                const timestamp = new Date().getTime();
                
                // MetodÄƒ 1: URL direct de export (necesitÄƒ sheet public)
                const exportUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${SHEET_GID}&_=${timestamp}`;
                
                // MetodÄƒ 2: gviz API (mai permisiv cu CORS)
                const gvizUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&gid=${SHEET_GID}&_=${timestamp}`;
                
                console.log('ðŸ“¡ Se Ã®ncearcÄƒ descÄƒrcarea datelor...');
                
                try {
                    // ÃŽncearcÄƒ gviz API mai Ã®ntÃ¢i (mai permisiv)
                    const response = await fetch(gvizUrl, {
                        mode: 'cors',
                        credentials: 'omit'
                    });
                    
                    if (response.ok) {
                        csvText = await response.text();
                        console.log('âœ… Date descÄƒrcate cu gviz API');
                    }
                } catch (e) {
                    console.log('âš ï¸ gviz API failed, trying export URL...');
                }
                
                // DacÄƒ gviz nu merge, Ã®ncearcÄƒ export URL
                if (!csvText || csvText.length < 100) {
                    try {
                        const response = await fetch(exportUrl, {
                            mode: 'cors',
                            credentials: 'omit'
                        });
                        
                        if (response.ok) {
                            csvText = await response.text();
                            console.log('âœ… Date descÄƒrcate cu export URL');
                        }
                    } catch (e) {
                        console.log('âš ï¸ Export URL failed');
                    }
                }
                
                if (!csvText || csvText.length < 100) {
                    throw new Error('Nu s-au putut descÄƒrca datele. VerificÄƒ cÄƒ Google Sheet-ul este public (Anyone with the link can view).');
                }
                
                const lines = csvText.trim().split('\n');
                const headers = parseCSVLine(lines[0]);
                const rows = lines.slice(1).map(line => parseCSVLine(line));

                // GÄƒseÈ™te index-uri coloane
                const numeIndex = headers.findIndex(h => h.includes('Nume complet'));
                const copilAdultIndex = headers.findIndex(h => h.includes('Copil / Adult'));
                const dojoIndex = headers.findIndex(h => h.includes('Dojo si Organizatia'));
                const gradIndex = headers.findIndex(h => h.includes('Grad Aikikai'));
                const participareIndex = headers.findIndex(h => h.includes('Participare'));

                // ÃŽnscriÈ™i = numÄƒr rÃ¢nduri cu Nume complet (coloana B) din sheet 87508598
                const inscrisi = rows.length;

                function normalizeNume(s) {
                    return (s || '').replace(/\r/g, '').trim().replace(/\s+/g, ' ');
                }
                let auParticipat = 0;
                const SHEET_LISTA_PARTICIPANTI_GID = '1372261625'; // participanÈ›i unici: coloana A, fÄƒrÄƒ header
                const uniqueNames = new Set();
                try {
                    const listPartUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&gid=${SHEET_LISTA_PARTICIPANTI_GID}&_=${timestamp}`;
                    const listPartRes = await fetch(listPartUrl, { mode: 'cors', credentials: 'omit' });
                    if (listPartRes.ok) {
                        const listPartCsv = await listPartRes.text();
                        if (listPartCsv && listPartCsv.length > 2) {
                            const listPartLines = listPartCsv.trim().split('\n');
                            listPartLines.forEach(line => {
                                const cells = parseCSVLine(line);
                                const nume = (cells[0] || '').replace(/\r/g, '').trim();
                                if (nume && nume.toLowerCase() !== 'nume') uniqueNames.add(nume);
                            });
                        }
                    }
                } catch (e) {
                    console.warn('âš ï¸ Sheet lista participanÈ›i (1372261625):', e.message);
                }
                console.log('âœ… ParticipanÈ›i unici din sheet 1372261625 col A:', uniqueNames.size);

                // Numere pentru cardurile Antrenament 1/2/3 (din sheet-urile de participare)
                const SHEET_ANTRENAMENT_GIDS = ['138549664', '1187751851', '423881536'];
                const perSheetCounts = [0, 0, 0];
                for (let i = 0; i < SHEET_ANTRENAMENT_GIDS.length; i++) {
                    const gid = SHEET_ANTRENAMENT_GIDS[i];
                    try {
                        const partUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&gid=${gid}&_=${timestamp}`;
                        const partRes = await fetch(partUrl, { mode: 'cors', credentials: 'omit' });
                        if (partRes.ok) {
                            const partCsv = await partRes.text();
                            if (partCsv && partCsv.length > 5) {
                                const partLines = partCsv.trim().split('\n');
                                partLines.forEach(line => {
                                    const cells = parseCSVLine(line);
                                    const nume = [0, 1, 2].map(j => (cells[j] || '').replace(/\r/g, '').trim()).find(s => s.length > 0) || '';
                                    if (nume) perSheetCounts[i]++;
                                });
                            }
                        }
                    } catch (e) {
                        console.warn('âš ï¸ Sheet antrenament', gid, ':', e.message);
                    }
                }
                console.log('âœ… Antrenament 1/2/3:', perSheetCounts);

                // Lista ParticipanÈ›i: toate numele unice din 1372261625 col A; date din 87508598 col B unde existÄƒ potrivire. Card = nr total unici (93).
                listParticipanti = [];
                const uniqueNamesSorted = Array.from(uniqueNames).sort();
                for (const nume of uniqueNamesSorted) {
                    const row = rows.find(r => normalizeNume(r[numeIndex]) === normalizeNume(nume));
                    if (row) {
                        const fullDojo = (row[dojoIndex] || '').trim();
                        const parts = fullDojo.split('/').map(p => p.trim());
                        listParticipanti.push({
                            nume: nume,
                            dojo: parts[0] || '',
                            organizatie: parts[1] || '',
                            categorie: (row[copilAdultIndex] || '').trim(),
                            grad: (row[gradIndex] || '').trim()
                        });
                    } else {
                        listParticipanti.push({ nume: nume, dojo: '', organizatie: '', categorie: '', grad: '' });
                    }
                }
                auParticipat = uniqueNames.size;
                console.log('âœ… ParticipanÈ›i (toÈ›i din 1372261625 col A):', auParticipat, '| cu date din 87508598:', listParticipanti.filter(p => p.dojo || p.organizatie || p.categorie || p.grad).length);

                // FRAA vs Alte, Copil vs Adult, Mudansha vs Yudansha (din listParticipanti)
                const fraaCount = listParticipanti.filter(p => (String(p.organizatie || '').toUpperCase().includes('FRAA'))).length;
                const alteOrganizatiiCount = listParticipanti.length - fraaCount;
                const copilLista = listParticipanti.filter(p => (String(p.categorie || '').toUpperCase().includes('COPIL'))).length;
                const adultLista = listParticipanti.length - copilLista;
                const yudanshaLista = listParticipanti.filter(p => {
                    const g = String(p.grad || '').toUpperCase();
                    return g.includes('YUDANSHA') || (g.includes('DAN') && !g.includes('MUDANSHA'));
                }).length;
                const mudanshaLista = listParticipanti.length - yudanshaLista;

                // Dojo-uri participante (din listParticipanti)
                const dojosParticipanti = {};
                listParticipanti.forEach(function(p) {
                    const d = (p.dojo || '').trim() || 'Nespecificat';
                    dojosParticipanti[d] = (dojosParticipanti[d] || 0) + 1;
                });

                // CalculeazÄƒ statistici
                const stats = {
                    total: inscrisi,
                    inscrisi,
                    auParticipat,
                    fraa: fraaCount,
                    alteOrganizatii: alteOrganizatiiCount,
                    copilLista,
                    adultLista,
                    mudanshaLista,
                    yudanshaLista,
                    antrenament1: perSheetCounts[0],
                    antrenament2: perSheetCounts[1],
                    antrenament3: perSheetCounts[2],
                    dojosParticipanti: dojosParticipanti,
                    copilAdult: {},
                    grade: {},
                    dojos: {},
                    organizatii: {},
                    participare: {}
                };

                console.log(`âœ… DescÄƒrcat: ${rows.length} Ã®nscriÈ™i`);

                // ReseteazÄƒ array-ul de participanÈ›i
                allParticipants = [];

                rows.forEach(row => {
                    const nume = row[numeIndex] || 'Nespecificat';
                    const category = row[copilAdultIndex] || 'Nespecificat';
                    stats.copilAdult[category] = (stats.copilAdult[category] || 0) + 1;

                    const grad = row[gradIndex] || 'Nespecificat';
                    stats.grade[grad] = (stats.grade[grad] || 0) + 1;

                    const fullDojo = row[dojoIndex] || 'Nespecificat';
                    const parts = fullDojo.split('/').map(p => p.trim());
                    const dojo = parts[0];
                    const org = parts[1] || 'Nespecificat';

                    stats.dojos[dojo] = (stats.dojos[dojo] || 0) + 1;
                    stats.organizatii[org] = (stats.organizatii[org] || 0) + 1;

                    const participareRaw = row[participareIndex] || 'Nespecificat';
                    // DeterminÄƒ tipul: "Toate" sau "Specific"
                    const participareTip = participareRaw.toLowerCase().includes('toate') ? 'Toate antrenamentele' : 'Sesiuni specifice';
                    stats.participare[participareTip] = (stats.participare[participareTip] || 0) + 1;

                    // AdaugÄƒ participantul Ã®n array
                    allParticipants.push({
                        nume: nume,
                        dojo: dojo,
                        organizatie: org,
                        categorie: category,
                        grad: grad
                    });
                });

                // PopuleazÄƒ tabelele
                populateParticipantsTable(allParticipants);
                populateListaParticipantiTable(listParticipanti);
                console.log(`ðŸ“‹ Tabel populat cu ${allParticipants.length} Ã®nscriÈ™i, ${listParticipanti.length} participanÈ›i unici`);

                // ActualizeazÄƒ cardurile ÃŽnscriÈ™i / ParticipanÈ›i, FRAA vs Alte, antrenament 1/2/3
                document.getElementById('inscrisi').textContent = stats.inscrisi;
                document.getElementById('auParticipat').textContent = stats.auParticipat;
                document.getElementById('fraaCount').textContent = stats.fraa;
                document.getElementById('alteOrganizatiiCount').textContent = stats.alteOrganizatii;
                document.getElementById('copilListaCount').textContent = stats.copilLista;
                document.getElementById('adultListaCount').textContent = stats.adultLista;
                document.getElementById('mudanshaListaCount').textContent = stats.mudanshaLista;
                document.getElementById('yudanshaListaCount').textContent = stats.yudanshaLista;
                document.getElementById('antrenament1').textContent = stats.antrenament1;
                document.getElementById('antrenament2').textContent = stats.antrenament2;
                document.getElementById('antrenament3').textContent = stats.antrenament3;

                // SalveazÄƒ datele È™i actualizeazÄƒ graficele
                saveData(stats);
                updateCharts(stats);
                
                // ActualizeazÄƒ display-ul ultimei sincronizÄƒri
                updateLastSyncDisplay();

                btn.textContent = `âœ… Sincronizat! (${stats.inscrisi} Ã®nscriÈ™i, ${stats.auParticipat} participanÈ›i)`;
                btn.style.background = 'linear-gradient(135deg, #0f9d58 0%, #16c172 100%)';
                
                setTimeout(() => {
                    btn.textContent = 'ðŸ”„ Sync din Google Sheets';
                    btn.style.background = 'linear-gradient(135deg, #dc2626 0%, #991b1b 100%)';
                    btn.classList.remove('loading');
                    btn.disabled = false;
                }, 2000);

            } catch (error) {
                console.error('Eroare la sincronizare:', error);
                btn.textContent = 'âŒ Eroare la sincronizare';
                btn.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                
                setTimeout(() => {
                    btn.textContent = 'ðŸ”„ Sync din Google Sheets';
                    btn.style.background = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
                    btn.classList.remove('loading');
                    btn.disabled = false;
                }, 3000);
            }
        }

    </script>
</body>
</html>

