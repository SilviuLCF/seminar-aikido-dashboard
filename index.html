<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Seminar Iulian Perpelici 6 Dan, Bucure»ôti - Mirai Dojo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            overflow-x: hidden;
            max-width: 100%;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            overflow-x: hidden;
        }

        header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(220, 38, 38, 0.3);
            border: 2px solid #dc2626;
            margin-bottom: 30px;
            text-align: center;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
            position: relative;
        }

        .header-logo {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            max-height: 120px;
            width: auto;
            opacity: 0.95;
            transition: opacity 0.3s ease;
        }

        .header-logo:hover {
            opacity: 1;
        }

        h1 {
            color: #ffffff;
            font-size: 2.5em;
            margin-bottom: 10px;
            line-height: 1.3;
            text-shadow: 2px 2px 4px rgba(220, 38, 38, 0.5);
        }

        h1 .title-line1 {
            display: block;
            font-size: 1em;
        }

        h1 .title-line2 {
            display: block;
            font-size: 0.75em;
            margin-top: 10px;
            color: #dc2626;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            color: #d1d5db;
            font-size: 1.2em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .stats-grid:last-of-type {
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .stats-grid.single-card {
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        .stats-grid.stats-grid-4 {
            grid-template-columns: repeat(4, minmax(200px, 1fr));
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .stat-card.total-card {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            box-shadow: 0 10px 30px rgba(220, 38, 38, 0.5);
            border: 2px solid #dc2626;
        }

        .stat-card.total-card .stat-number {
            color: white;
            -webkit-text-fill-color: white;
            font-size: 4em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .stat-card.total-card .stat-label {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.3em;
            font-weight: 600;
        }

        .stat-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
            border: 1px solid #dc2626;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.5);
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #d1d5db;
            font-size: 1.1em;
            margin-top: 10px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            margin-bottom: 30px;
        }

        .chart-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
            border: 1px solid #dc2626;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .chart-title {
            font-size: 1.5em;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(220, 38, 38, 0.5);
        }

        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
            max-width: 100%;
        }

        .chart-container canvas {
            max-width: 100% !important;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        footer {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
            border: 1px solid #dc2626;
            text-align: center;
            color: #d1d5db;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #dc2626;
        }

        .tab {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #d1d5db;
            border: 1px solid #dc2626;
            border-bottom: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            color: #ffffff;
        }

        .tab.active {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            box-shadow: 0 -3px 10px rgba(220, 38, 38, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Tabel participan»õi */
        .participants-table-container {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
            border: 1px solid #dc2626;
            overflow-x: auto;
        }

        .participants-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .participants-table th {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #991b1b;
        }

        .participants-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #374151;
            color: #d1d5db;
        }

        .participants-table tr:hover {
            background: rgba(220, 38, 38, 0.1);
        }

        .participants-table tr:last-child td {
            border-bottom: none;
        }

        .table-search {
            width: 100%;
            padding: 12px;
            background: #2d2d2d;
            border: 1px solid #dc2626;
            border-radius: 8px;
            color: #d1d5db;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .table-search::placeholder {
            color: #9ca3af;
        }

        .table-info {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .sync-btn {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            border: 2px solid #dc2626;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.5);
            transition: all 0.3s ease;
        }

        .sync-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(220, 38, 38, 0.7);
            background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%);
        }

        .sync-btn:active {
            transform: translateY(0);
        }

        .sync-btn.loading {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            cursor: wait;
            border-color: #dc2626;
        }

        @media (max-width: 768px) {
            html, body {
                overflow-x: hidden;
                max-width: 100vw;
                width: 100%;
            }

            body {
                padding: 10px;
            }

            .container {
                padding: 0;
                width: 100%;
                max-width: 100%;
            }

            .charts-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .stat-number {
                font-size: 2.2em;
            }

            h1 .title-line1 {
                font-size: 1.3rem;
            }
            
            h1 .title-line2 {
                font-size: 0.95rem;
            }

            header {
                padding: 15px 10px;
                margin-bottom: 15px;
            }

            .header-logo {
                position: static;
                transform: none;
                max-height: 80px;
                margin: 15px auto 0;
                display: block;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 10px;
                margin-bottom: 15px;
                width: 100%;
                max-width: 100%;
            }

            .stats-grid.stats-grid-4 {
                grid-template-columns: repeat(2, 1fr);
                max-width: 100%;
            }

            .stat-card {
                padding: 15px 8px;
                width: 100%;
                max-width: 100%;
            }

            .stat-label {
                font-size: 0.85rem;
            }

            .charts-grid {
                grid-template-columns: 1fr !important;
                gap: 15px;
                width: 100%;
                max-width: 100%;
            }

            .chart-card {
                width: 100%;
                max-width: 100%;
                overflow: hidden;
            }

            .chart-container {
                width: 100% !important;
                max-width: 100% !important;
            }

            .chart-card {
                min-height: 280px;
                padding: 12px;
                margin-bottom: 0;
            }

            .chart-title {
                font-size: 0.95rem;
                margin-bottom: 8px;
                padding: 0;
            }

            .chart-container {
                height: 230px !important;
            }

            .sync-btn {
                font-size: 0.85rem;
                padding: 10px 18px;
                width: 100%;
                max-width: 300px;
            }

            footer {
                padding: 15px 10px;
                font-size: 0.85rem;
            }

            .tabs {
                gap: 5px;
            }

            .tab {
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            .participants-table th,
            .participants-table td {
                padding: 10px 8px;
                font-size: 0.85rem;
            }

            .table-search {
                font-size: 0.85rem;
            }
        }

        /* Extra responsiveness for charts */
        @media (max-width: 480px) {
            html, body {
                overflow-x: hidden !important;
                max-width: 100vw !important;
                width: 100% !important;
            }

            body {
                padding: 5px;
            }

            .container {
                width: 100% !important;
                max-width: 100% !important;
                padding: 0 !important;
            }

            h1 .title-line1 {
                font-size: 1.1rem;
            }
            
            h1 .title-line2 {
                font-size: 0.85rem;
            }

            header {
                padding: 12px 8px;
            }

            .header-logo {
                max-height: 60px;
                margin-top: 10px;
            }

            .subtitle {
                font-size: 0.8rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
                gap: 5px;
                width: 100% !important;
                max-width: 100% !important;
            }

            .stat-card {
                padding: 10px 5px;
                width: 100% !important;
                max-width: 100% !important;
            }

            .stat-card.total-card .stat-number {
                font-size: 2.5em;
            }

            .stat-number {
                font-size: 1.8em;
            }

            .stat-label {
                font-size: 0.75rem;
            }

            .chart-card {
                min-height: 260px;
                padding: 8px;
                width: 100% !important;
                max-width: 100% !important;
                overflow: hidden !important;
            }

            .chart-title {
                font-size: 0.85rem;
                margin-bottom: 5px;
            }

            .chart-container {
                height: 210px !important;
                width: 100% !important;
                max-width: 100% !important;
            }

            .charts-grid {
                width: 100% !important;
                max-width: 100% !important;
                gap: 8px;
            }

            .sync-btn {
                font-size: 0.8rem;
                padding: 10px 15px;
            }

            .tab {
                padding: 8px 12px;
                font-size: 0.75rem;
            }

            .participants-table th,
            .participants-table td {
                padding: 8px 5px;
                font-size: 0.75rem;
            }

            .participants-table-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span class="title-line1">üìä Dashboard Seminar Iulian Perpelici 6 Dan</span>
                <span class="title-line2">Bucure»ôti - Mirai Dojo</span>
            </h1>
            <p class="subtitle">AnalizƒÉ completƒÉ a √ÆnregistrƒÉrilor pentru eveniment</p>
            <p class="subtitle" id="lastSyncInfo" style="font-size: 0.9em; margin-top: 5px; color: #9ca3af;"></p>
            <button class="sync-btn" onclick="syncData()" id="syncBtn">
                üîÑ Sync din Google Sheets
            </button>
            <img src="logo-mirai-dojo.png" alt="Mirai Dojo Logo" class="header-logo">
        </header>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">
                üìä Dashboard
            </div>
            <div class="tab" onclick="switchTab('participants')">
                üë• Lista √énscri»ôi
            </div>
            <div class="tab" onclick="switchTab('listaparticipanti')">
                ‚úÖ Lista Participan»õi
            </div>
        </div>

        <!-- Tab Content: Dashboard -->
        <div id="dashboard-tab" class="tab-content active">
        <div class="stats-grid stats-grid-4">
            <div class="stat-card" style="border-color: #0f9d58;">
                <div class="stat-label" style="margin-bottom: 12px; font-weight: 600; color: #9ca3af;">√énscri»ôi vs Participan»õi</div>
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <div class="stat-number" id="inscrisi" style="color: #0f9d58; -webkit-text-fill-color: #0f9d58;">0</div>
                        <div class="stat-label">√énscri»ôi</div>
                    </div>
                    <div style="width: 2px; height: 50px; background: #374151;"></div>
                    <div>
                        <div class="stat-number" id="auParticipat" style="color: #0f9d58; -webkit-text-fill-color: #0f9d58;">0</div>
                        <div class="stat-label">Participan»õi</div>
                    </div>
                </div>
            </div>
            <div class="stat-card" style="border-color: #6366f1;">
                <div class="stat-label" style="margin-bottom: 12px; font-weight: 600; color: #9ca3af;">FRAA vs Alte organiza»õii</div>
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <div class="stat-number" id="fraaCount" style="color: #6366f1; -webkit-text-fill-color: #6366f1;">0</div>
                        <div class="stat-label">FRAA</div>
                    </div>
                    <div style="width: 2px; height: 50px; background: #374151;"></div>
                    <div>
                        <div class="stat-number" id="alteOrganizatiiCount" style="color: #6366f1; -webkit-text-fill-color: #6366f1;">0</div>
                        <div class="stat-label">Alte organiza»õii</div>
                    </div>
                </div>
            </div>
            <div class="stat-card" style="border-color: #eab308;">
                <div class="stat-label" style="margin-bottom: 12px; font-weight: 600; color: #9ca3af;">Copil vs Adult</div>
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <div class="stat-number" id="copilListaCount" style="color: #eab308; -webkit-text-fill-color: #eab308;">0</div>
                        <div class="stat-label">Copil</div>
                    </div>
                    <div style="width: 2px; height: 50px; background: #374151;"></div>
                    <div>
                        <div class="stat-number" id="adultListaCount" style="color: #eab308; -webkit-text-fill-color: #eab308;">0</div>
                        <div class="stat-label">Adult</div>
                    </div>
                </div>
            </div>
            <div class="stat-card" style="border-color: #ec4899;">
                <div class="stat-label" style="margin-bottom: 12px; font-weight: 600; color: #9ca3af;">Mudansha vs Yudansha</div>
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <div class="stat-number" id="mudanshaListaCount" style="color: #ec4899; -webkit-text-fill-color: #ec4899;">0</div>
                        <div class="stat-label">Mudansha</div>
                    </div>
                    <div style="width: 2px; height: 50px; background: #374151;"></div>
                    <div>
                        <div class="stat-number" id="yudanshaListaCount" style="color: #ec4899; -webkit-text-fill-color: #ec4899;">0</div>
                        <div class="stat-label">Yudansha</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="antrenament1">0</div>
                <div class="stat-label">Participan»õi antrenament 1</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="antrenament2">0</div>
                <div class="stat-label">Participan»õi antrenament 2</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="antrenament3">0</div>
                <div class="stat-label">Participan»õi antrenament 3</div>
            </div>
        </div>
        <div class="stats-grid single-card">
            <div class="stat-card total-card">
                <div class="stat-number" id="totalParticipanti">37</div>
                <div class="stat-label">Total Participan»õi</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalAdulti">32</div>
                <div class="stat-label">Adul»õi</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCopii">5</div>
                <div class="stat-label">Copii</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalYudansha">15</div>
                <div class="stat-label">Yudansha (Dan)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalMudansha">22</div>
                <div class="stat-label">Mudansha (Kyu)</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <h2 class="chart-title">üë• Distribu»õie Participan»õi: Copil vs Adult</h2>
                <div class="chart-container">
                    <canvas id="copilAdultChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h2 class="chart-title">ü•ã Distribu»õie Grade: Yudansha vs Mudansha</h2>
                <div class="chart-container">
                    <canvas id="gradeChart"></canvas>
                </div>
            </div>

            <div class="chart-card full-width">
                <h2 class="chart-title">üìä Participan»õi pe Dojo-uri</h2>
                <div class="chart-container">
                    <canvas id="dojoChart"></canvas>
                </div>
            </div>

            <div class="chart-card full-width">
                <h2 class="chart-title">üèõÔ∏è Participan»õi pe Organiza»õii</h2>
                <div class="chart-container">
                    <canvas id="organizatieChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h2 class="chart-title">üìÖ Tip Participare</h2>
                <div class="chart-container">
                    <canvas id="participareChart"></canvas>
                </div>
            </div>
        </div>
        </div>
        <!-- End Dashboard Tab -->

        <!-- Tab Content: Lista √énscri»ôi -->
        <div id="participants-tab" class="tab-content">
            <div class="participants-table-container">
                <h2 style="color: #ffffff; margin-bottom: 15px; text-align: center;">üìã Lista CompletƒÉ √énscri»ôi</h2>
                <input type="text" id="searchInput" class="table-search" placeholder="üîç CautƒÉ participant (nume, dojo, organiza»õie...)">
                <div class="table-info" id="tableInfo">Se √ÆncarcƒÉ √Ænscri»ôii...</div>
                <table class="participants-table" id="participantsTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nume Complet</th>
                            <th>Dojo</th>
                            <th>Organiza»õie</th>
                            <th>Categorie</th>
                            <th>Grad</th>
                        </tr>
                    </thead>
                    <tbody id="participantsTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">
                                ApasƒÉ butonul "Sync" pentru a √ÆncƒÉrca √Ænscri»ôii
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- End Lista √énscri»ôi Tab -->

        <!-- Tab Content: Lista Participan»õi (nume din 1372261625 col A, date din 87508598 col B) -->
        <div id="listaparticipanti-tab" class="tab-content">
            <div class="participants-table-container">
                <h2 style="color: #ffffff; margin-bottom: 15px; text-align: center;">‚úÖ Lista Participan»õi (unici)</h2>
                <input type="text" id="searchParticipanti" class="table-search" placeholder="üîç CautƒÉ (nume, dojo, organiza»õie, categorie, grad...)">
                <div class="table-info" id="tableInfoParticipanti">Se √ÆncarcƒÉ participan»õii...</div>
                <table class="participants-table" id="participantiTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nume</th>
                            <th>Dojo</th>
                            <th>Organiza»õie</th>
                            <th>Copil / Adult</th>
                            <th>Grad</th>
                        </tr>
                    </thead>
                    <tbody id="participantiTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">
                                ApasƒÉ "Sync" pentru a √ÆncƒÉrca lista participan»õilor
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- End Lista Participan»õi Tab -->

        <footer>
            <p>Dashboard generat automat din datele Form Responses 1</p>
            <p>Ultima actualizare: <strong id="lastUpdate"></strong></p>
        </footer>
    </div>

    <script>
        // SeteazƒÉ data ultimei actualizƒÉri
        document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ro-RO');

        // Configura»õie culori
        const colors = {
            primary: ['#dc2626', '#ef4444', '#f87171', '#991b1b', '#b91c1c', '#7f1d1d', '#fca5a5', '#dc2626'],
            copilAdult: ['#dc2626', '#4b5563'],
            mirai: ['#dc2626', '#1a1a1a'],
        };

        // Variabile globale pentru grafice »ôi date
        let copilAdultChart, gradeChart, dojoChart, organizatieChart, participareChart;
        let allParticipants = [];
        let listParticipanti = [];

        // Date default pentru grafice
        const defaultData = {
            total: 37,
            copilAdult: { 'Adult': 32, 'Copil': 5 },
            grade: { 'Mudansha (grad Kyu)': 22, 'Yudansha (grad Dan)': 15 },
            dojos: {
                'Mirai Dojo': 14,
                'Dumkan Dojo': 14,
                'Raijin dojo': 6,
                'Aikido Aikikai Constanta': 2,
                'Aikido Mangalia': 1
            },
            organizatii: { 'Asociatia Dumkan': 20, 'FRAA': 17 },
            participare: { 'Toate antrenamentele': 30, 'Sesiuni specifice': 7 },
            inscrisi: 0,
            auParticipat: 0,
            fraa: 0,
            alteOrganizatii: 0,
            copilLista: 0,
            adultLista: 0,
            mudanshaLista: 0,
            yudanshaLista: 0,
            antrenament1: 0,
            antrenament2: 0,
            antrenament3: 0
        };

        // √éncearcƒÉ sƒÉ √Æncarci date din localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('dashboardData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.inscrisi === undefined) data.inscrisi = 0;
                    if (data.auParticipat === undefined) data.auParticipat = 0;
                    if (data.fraa === undefined) data.fraa = 0;
                    if (data.alteOrganizatii === undefined) data.alteOrganizatii = 0;
                    if (data.copilLista === undefined) data.copilLista = 0;
                    if (data.adultLista === undefined) data.adultLista = 0;
                    if (data.mudanshaLista === undefined) data.mudanshaLista = 0;
                    if (data.yudanshaLista === undefined) data.yudanshaLista = 0;
                    if (data.antrenament1 === undefined) data.antrenament1 = 0;
                    if (data.antrenament2 === undefined) data.antrenament2 = 0;
                    if (data.antrenament3 === undefined) data.antrenament3 = 0;
                    return data;
                } catch (e) {
                    console.error('Eroare la parsarea datelor salvate:', e);
                    return defaultData;
                }
            }
            return defaultData;
        }

        // SalveazƒÉ datele √Æn localStorage
        function saveData(stats) {
            localStorage.setItem('dashboardData', JSON.stringify(stats));
            localStorage.setItem('lastUpdate', new Date().toISOString());
            localStorage.setItem('participants', JSON.stringify(allParticipants));
            localStorage.setItem('listParticipanti', JSON.stringify(listParticipanti));
        }

        // √éncarcƒÉ participan»õii din localStorage
        function loadSavedParticipants() {
            const saved = localStorage.getItem('participants');
            if (saved) {
                try {
                    allParticipants = JSON.parse(saved);
                    populateParticipantsTable(allParticipants);
                    console.log(`üìã Participan»õi √ÆncƒÉrca»õi din cache: ${allParticipants.length}`);
                } catch (e) {
                    console.error('Eroare la √ÆncƒÉrcarea participan»õilor:', e);
                }
            }
        }

        // √éncarcƒÉ datele salvate sau default
        const savedStats = loadSavedData();

        // Date pentru grafice (din localStorage sau default)
        const copilAdultData = {
            labels: Object.keys(savedStats.copilAdult),
            datasets: [{
                data: Object.values(savedStats.copilAdult),
                backgroundColor: colors.copilAdult,
                borderWidth: 0,
                hoverOffset: 15
            }]
        };

        const dojoData = {
            labels: Object.keys(savedStats.dojos),
            datasets: [{
                label: 'NumƒÉr participan»õi',
                data: Object.values(savedStats.dojos),
                backgroundColor: colors.primary.slice(0, Object.keys(savedStats.dojos).length),
                borderWidth: 0,
                borderRadius: 8
            }]
        };

        const gradeData = {
            labels: Object.keys(savedStats.grade),
            datasets: [{
                data: Object.values(savedStats.grade),
                backgroundColor: ['#dc2626', '#4b5563'],
                borderWidth: 0,
                hoverOffset: 15
            }]
        };

        const organizatieData = {
            labels: Object.keys(savedStats.organizatii),
            datasets: [{
                label: 'NumƒÉr participan»õi',
                data: Object.values(savedStats.organizatii),
                backgroundColor: ['#dc2626', '#6b7280'],
                borderWidth: 0,
                borderRadius: 8
            }]
        };

        const participareData = {
            labels: Object.keys(savedStats.participare),
            datasets: [{
                data: Object.values(savedStats.participare),
                backgroundColor: ['#dc2626', '#374151'],
                borderWidth: 0,
                hoverOffset: 15
            }]
        };

        // Configura»õie comunƒÉ pentru grafice
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                        padding: window.innerWidth < 480 ? 5 : (window.innerWidth < 768 ? 8 : 20),
                        font: {
                            size: window.innerWidth < 480 ? 9 : (window.innerWidth < 768 ? 10 : 14),
                            family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
                        },
                        boxWidth: window.innerWidth < 480 ? 25 : (window.innerWidth < 768 ? 30 : 40),
                        usePointStyle: window.innerWidth < 768,
                        color: '#d1d5db'
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    padding: window.innerWidth < 768 ? 8 : 12,
                    titleFont: {
                        size: window.innerWidth < 768 ? 12 : 16
                    },
                    bodyFont: {
                        size: window.innerWidth < 768 ? 11 : 14
                    },
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += context.parsed || context.parsed.y;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                            label += ` (${percentage}%)`;
                            return label;
                        }
                    }
                }
            }
        };

        // Grafic Copil vs Adult (Pie)
        copilAdultChart = new Chart(document.getElementById('copilAdultChart'), {
            type: 'doughnut',
            data: copilAdultData,
            options: {
                ...commonOptions,
                cutout: '60%'
            }
        });

        // Grafic Dojo-uri (Bar)
        dojoChart = new Chart(document.getElementById('dojoChart'), {
            type: 'bar',
            data: dojoData,
            options: {
                ...commonOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 2,
                            font: {
                                size: window.innerWidth < 480 ? 9 : (window.innerWidth < 768 ? 10 : 12)
                            },
                            color: '#d1d5db'
                        },
                        grid: {
                            color: 'rgba(220, 38, 38, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: window.innerWidth < 480 ? 9 : (window.innerWidth < 768 ? 10 : 12)
                            },
                            maxRotation: window.innerWidth < 768 ? 45 : 0,
                            minRotation: window.innerWidth < 768 ? 45 : 0,
                            color: '#d1d5db'
                        },
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    ...commonOptions.plugins,
                    datalabels: {
                        display: false
                    }
                }
            },
            plugins: [{
                id: 'datalabels',
                afterDatasetsDraw(chart) {
                    const { ctx, data } = chart;
                    const fontSize = window.innerWidth < 480 ? 12 : (window.innerWidth < 768 ? 14 : 18);
                    chart.getDatasetMeta(0).data.forEach((datapoint, index) => {
                        const value = data.datasets[0].data[index];
                        const yPos = datapoint.y + ((datapoint.base - datapoint.y) / 2);
                        ctx.font = `bold ${fontSize}px sans-serif`;
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(value, datapoint.x, yPos);
                    });
                }
            }]
        });

        // Grafic Grade (Doughnut - la fel ca Copil/Adult)
        gradeChart = new Chart(document.getElementById('gradeChart'), {
            type: 'doughnut',
            data: gradeData,
            options: {
                ...commonOptions,
                cutout: '60%'
            }
        });

        // Grafic Organiza»õii (Bar)
        organizatieChart = new Chart(document.getElementById('organizatieChart'), {
            type: 'bar',
            data: organizatieData,
            options: {
                ...commonOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 5,
                            font: {
                                size: window.innerWidth < 480 ? 9 : (window.innerWidth < 768 ? 10 : 12)
                            },
                            color: '#d1d5db'
                        },
                        grid: {
                            color: 'rgba(220, 38, 38, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: window.innerWidth < 480 ? 10 : (window.innerWidth < 768 ? 11 : 14)
                            },
                            color: '#d1d5db'
                        },
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    ...commonOptions.plugins,
                    datalabels: {
                        display: false
                    }
                }
            },
            plugins: [{
                id: 'datalabels',
                afterDatasetsDraw(chart) {
                    const { ctx, data } = chart;
                    const fontSize = window.innerWidth < 480 ? 12 : (window.innerWidth < 768 ? 14 : 18);
                    chart.getDatasetMeta(0).data.forEach((datapoint, index) => {
                        const value = data.datasets[0].data[index];
                        const yPos = datapoint.y + ((datapoint.base - datapoint.y) / 2);
                        ctx.font = `bold ${fontSize}px sans-serif`;
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(value, datapoint.x, yPos);
                    });
                }
            }]
        });

        // Func»õie pentru schimbarea √Æntre tabs
        function switchTab(tabName) {
            // Ascunde toate tab-urile
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Afi»ôeazƒÉ tab-ul selectat
            if (tabName === 'dashboard') {
                document.getElementById('dashboard-tab').classList.add('active');
                document.querySelectorAll('.tab')[0].classList.add('active');
            } else if (tabName === 'participants') {
                document.getElementById('participants-tab').classList.add('active');
                document.querySelectorAll('.tab')[1].classList.add('active');
            } else if (tabName === 'listaparticipanti') {
                document.getElementById('listaparticipanti-tab').classList.add('active');
                document.querySelectorAll('.tab')[2].classList.add('active');
            }
        }

        // Func»õie pentru popularea tabelului de participan»õi
        function populateParticipantsTable(participants) {
            const tbody = document.getElementById('participantsTableBody');
            const tableInfo = document.getElementById('tableInfo');
            
            if (!participants || participants.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">Nu existƒÉ √Ænscri»ôi</td></tr>';
                tableInfo.textContent = 'Nu existƒÉ date disponibile';
                return;
            }

            tbody.innerHTML = '';
            participants.forEach((p, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><strong>${p.nume}</strong></td>
                    <td>${p.dojo}</td>
                    <td>${p.organizatie}</td>
                    <td>${p.categorie}</td>
                    <td>${p.grad}</td>
                `;
                tbody.appendChild(row);
            });

            tableInfo.textContent = `Total: ${participants.length} √Ænscri»ôi`;
        }

        // Func»õie pentru popularea tabelei Lista Participan»õi
        function populateListaParticipantiTable(participanti) {
            const tbody = document.getElementById('participantiTableBody');
            const tableInfo = document.getElementById('tableInfoParticipanti');
            if (!participanti || participanti.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">Nu existƒÉ participan»õi sau apasƒÉ Sync.</td></tr>';
                tableInfo.textContent = '0 participan»õi';
                return;
            }
            tbody.innerHTML = '';
            participanti.forEach((p, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><strong>${p.nume}</strong></td>
                    <td>${p.dojo}</td>
                    <td>${p.organizatie}</td>
                    <td>${p.categorie}</td>
                    <td>${p.grad}</td>
                `;
                tbody.appendChild(row);
            });
            tableInfo.textContent = `Total: ${participanti.length} participan»õi unici`;
        }

        // Func»õie pentru cƒÉutare √Æn tabel
        function setupTableSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = allParticipants.filter(p => {
                    return (
                        p.nume.toLowerCase().includes(searchTerm) ||
                        p.dojo.toLowerCase().includes(searchTerm) ||
                        p.organizatie.toLowerCase().includes(searchTerm) ||
                        p.categorie.toLowerCase().includes(searchTerm) ||
                        p.grad.toLowerCase().includes(searchTerm)
                    );
                });
                populateParticipantsTable(filtered);
            });
            const searchParticipanti = document.getElementById('searchParticipanti');
            searchParticipanti.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = listParticipanti.filter(p => {
                    return (
                        (p.nume || '').toLowerCase().includes(searchTerm) ||
                        (p.dojo || '').toLowerCase().includes(searchTerm) ||
                        (p.organizatie || '').toLowerCase().includes(searchTerm) ||
                        (p.categorie || '').toLowerCase().includes(searchTerm) ||
                        (p.grad || '').toLowerCase().includes(searchTerm)
                    );
                });
                populateListaParticipantiTable(filtered);
            });
        }

        // Anima»õie pentru numerele din carduri
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            const range = end - start;
            const increment = end > start ? 1 : -1;
            const stepTime = Math.abs(Math.floor(duration / range));
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                obj.textContent = current;
                if (current === end) {
                    clearInterval(timer);
                }
            }, stepTime);
        }

        // ActualizeazƒÉ cardurile cu datele salvate
        function updateCards(stats) {
            document.getElementById('totalParticipanti').textContent = stats.total;
            document.getElementById('totalAdulti').textContent = stats.copilAdult['Adult'] || 0;
            document.getElementById('totalCopii').textContent = stats.copilAdult['Copil'] || 0;
            document.getElementById('totalYudansha').textContent = stats.grade['Yudansha (grad Dan)'] || 0;
            document.getElementById('totalMudansha').textContent = stats.grade['Mudansha (grad Kyu)'] || 0;
            document.getElementById('inscrisi').textContent = stats.inscrisi ?? 0;
            document.getElementById('auParticipat').textContent = stats.auParticipat ?? 0;
            document.getElementById('fraaCount').textContent = stats.fraa ?? 0;
            document.getElementById('alteOrganizatiiCount').textContent = stats.alteOrganizatii ?? 0;
            document.getElementById('copilListaCount').textContent = stats.copilLista ?? 0;
            document.getElementById('adultListaCount').textContent = stats.adultLista ?? 0;
            document.getElementById('mudanshaListaCount').textContent = stats.mudanshaLista ?? 0;
            document.getElementById('yudanshaListaCount').textContent = stats.yudanshaLista ?? 0;
            document.getElementById('antrenament1').textContent = stats.antrenament1 ?? 0;
            document.getElementById('antrenament2').textContent = stats.antrenament2 ?? 0;
            document.getElementById('antrenament3').textContent = stats.antrenament3 ?? 0;
        }

        // ActualizeazƒÉ afi»ôajul ultimei sincronizƒÉri
        function updateLastSyncDisplay() {
            const lastUpdate = localStorage.getItem('lastUpdate');
            const syncInfo = document.getElementById('lastSyncInfo');
            if (lastUpdate) {
                const date = new Date(lastUpdate);
                syncInfo.textContent = `Ultima sincronizare: ${date.toLocaleString('ro-RO')}`;
                syncInfo.style.display = 'block';
            } else {
                syncInfo.style.display = 'none';
            }
        }

        // AnimeazƒÉ numerele la √ÆncƒÉrcarea paginii cu datele salvate
        window.addEventListener('load', async () => {
            // SeteazƒÉ func»õia de search
            setupTableSearch();

            const lastUpdate = localStorage.getItem('lastUpdate');
            
            // DacƒÉ nu existƒÉ date salvate sau sunt mai vechi de 5 minute, fƒÉ sync automat
            if (!lastUpdate) {
                console.log('üîÑ Prima √ÆncƒÉrcare - se sincronizeazƒÉ automat datele...');
                // Afi»ôeazƒÉ loading pe toate cardurile
                document.getElementById('totalParticipanti').textContent = '...';
                document.getElementById('totalAdulti').textContent = '...';
                document.getElementById('totalCopii').textContent = '...';
                document.getElementById('totalYudansha').textContent = '...';
                document.getElementById('totalMudansha').textContent = '...';
                
                // FƒÉ sync automat
                await syncData();
            } else {
                // √éncarcƒÉ datele salvate
                const stats = loadSavedData();
                animateValue('totalParticipanti', 0, stats.total, 1000);
                animateValue('totalAdulti', 0, stats.copilAdult['Adult'] || 0, 1000);
                animateValue('totalCopii', 0, stats.copilAdult['Copil'] || 0, 1000);
                animateValue('totalYudansha', 0, stats.grade['Yudansha (grad Dan)'] || 0, 1000);
                animateValue('totalMudansha', 0, stats.grade['Mudansha (grad Kyu)'] || 0, 1000);
                document.getElementById('inscrisi').textContent = stats.inscrisi ?? 0;
                document.getElementById('auParticipat').textContent = stats.auParticipat ?? 0;
                document.getElementById('antrenament1').textContent = stats.antrenament1 ?? 0;
                document.getElementById('antrenament2').textContent = stats.antrenament2 ?? 0;
                document.getElementById('antrenament3').textContent = stats.antrenament3 ?? 0;

                // √éncarcƒÉ participan»õii salva»õi
                loadSavedParticipants();
                const savedListPart = localStorage.getItem('listParticipanti');
                if (savedListPart) {
                    try {
                        listParticipanti = JSON.parse(savedListPart);
                        populateListaParticipantiTable(listParticipanti);
                        const fraa = listParticipanti.filter(p => (String(p.organizatie || '').toUpperCase().includes('FRAA'))).length;
                        document.getElementById('fraaCount').textContent = stats.fraa ?? fraa;
                        document.getElementById('alteOrganizatiiCount').textContent = stats.alteOrganizatii ?? (listParticipanti.length - fraa);
                        const copilL = listParticipanti.filter(p => (String(p.categorie || '').toUpperCase().includes('COPIL'))).length;
                        const adultL = listParticipanti.filter(p => (String(p.categorie || '').toUpperCase().includes('ADULT'))).length;
                        const yudanshaL = listParticipanti.filter(p => {
                            const g = String(p.grad || '').toUpperCase();
                            return g.includes('YUDANSHA') || (g.includes('DAN') && !g.includes('MUDANSHA'));
                        }).length;
                        const mudanshaL = listParticipanti.filter(p => {
                            const g = String(p.grad || '').toUpperCase();
                            return g.includes('MUDANSHA') || g.includes('KYU');
                        }).length;
                        document.getElementById('copilListaCount').textContent = stats.copilLista ?? copilL;
                        document.getElementById('adultListaCount').textContent = stats.adultLista ?? adultL;
                        document.getElementById('mudanshaListaCount').textContent = stats.mudanshaLista ?? mudanshaL;
                        document.getElementById('yudanshaListaCount').textContent = stats.yudanshaLista ?? yudanshaL;
                    } catch (e) { }
                } else {
                    document.getElementById('fraaCount').textContent = stats.fraa ?? 0;
                    document.getElementById('alteOrganizatiiCount').textContent = stats.alteOrganizatii ?? 0;
                    document.getElementById('copilListaCount').textContent = stats.copilLista ?? 0;
                    document.getElementById('adultListaCount').textContent = stats.adultLista ?? 0;
                    document.getElementById('mudanshaListaCount').textContent = stats.mudanshaLista ?? 0;
                    document.getElementById('yudanshaListaCount').textContent = stats.yudanshaLista ?? 0;
                }

                const date = new Date(lastUpdate);
                console.log(`üìä Date √ÆncƒÉrcate din ultima sincronizare: ${date.toLocaleString('ro-RO')}`);
            }
            
            // Afi»ôeazƒÉ data ultimei actualizƒÉri
            updateLastSyncDisplay();
        });

        // Func»õie pentru parsare CSV
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        // Grafic Participare (Doughnut)
        participareChart = new Chart(document.getElementById('participareChart'), {
            type: 'doughnut',
            data: participareData,
            options: {
                ...commonOptions,
                cutout: '60%'
            }
        });

        // Func»õie pentru sync date din Google Sheets
        async function syncData() {
            const btn = document.getElementById('syncBtn');
            btn.textContent = '‚è≥ Se sincronizeazƒÉ...';
            btn.classList.add('loading');
            btn.disabled = true;

            try {
                const SPREADSHEET_ID = '1HzNmWMrqhrD5uXejIS2pPUGxNJi-5gxiDU2pn7wxC1E';
                const SHEET_GID = '87508598';
                
                // √éncearcƒÉ mai multe metode de descƒÉrcare
                let csvText = null;
                const timestamp = new Date().getTime();
                
                // MetodƒÉ 1: URL direct de export (necesitƒÉ sheet public)
                const exportUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${SHEET_GID}&_=${timestamp}`;
                
                // MetodƒÉ 2: gviz API (mai permisiv cu CORS)
                const gvizUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&gid=${SHEET_GID}&_=${timestamp}`;
                
                console.log('üì° Se √ÆncearcƒÉ descƒÉrcarea datelor...');
                
                try {
                    // √éncearcƒÉ gviz API mai √Ænt√¢i (mai permisiv)
                    const response = await fetch(gvizUrl, {
                        mode: 'cors',
                        credentials: 'omit'
                    });
                    
                    if (response.ok) {
                        csvText = await response.text();
                        console.log('‚úÖ Date descƒÉrcate cu gviz API');
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è gviz API failed, trying export URL...');
                }
                
                // DacƒÉ gviz nu merge, √ÆncearcƒÉ export URL
                if (!csvText || csvText.length < 100) {
                    try {
                        const response = await fetch(exportUrl, {
                            mode: 'cors',
                            credentials: 'omit'
                        });
                        
                        if (response.ok) {
                            csvText = await response.text();
                            console.log('‚úÖ Date descƒÉrcate cu export URL');
                        }
                    } catch (e) {
                        console.log('‚ö†Ô∏è Export URL failed');
                    }
                }
                
                if (!csvText || csvText.length < 100) {
                    throw new Error('Nu s-au putut descƒÉrca datele. VerificƒÉ cƒÉ Google Sheet-ul este public (Anyone with the link can view).');
                }
                
                const lines = csvText.trim().split('\n');
                const headers = parseCSVLine(lines[0]);
                const rows = lines.slice(1).map(line => parseCSVLine(line));

                // GƒÉse»ôte index-uri coloane
                const numeIndex = headers.findIndex(h => h.includes('Nume complet'));
                const copilAdultIndex = headers.findIndex(h => h.includes('Copil / Adult'));
                const dojoIndex = headers.findIndex(h => h.includes('Dojo si Organizatia'));
                const gradIndex = headers.findIndex(h => h.includes('Grad Aikikai'));
                const participareIndex = headers.findIndex(h => h.includes('Participare'));

                // √énscri»ôi = numƒÉr r√¢nduri cu Nume complet (coloana B) din sheet 87508598
                const inscrisi = rows.length;

                function normalizeNume(s) {
                    return (s || '').replace(/\r/g, '').trim().replace(/\s+/g, ' ');
                }
                let auParticipat = 0;
                const SHEET_LISTA_PARTICIPANTI_GID = '1372261625'; // participan»õi unici: coloana A, fƒÉrƒÉ header
                const uniqueNames = new Set();
                try {
                    const listPartUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&gid=${SHEET_LISTA_PARTICIPANTI_GID}&_=${timestamp}`;
                    const listPartRes = await fetch(listPartUrl, { mode: 'cors', credentials: 'omit' });
                    if (listPartRes.ok) {
                        const listPartCsv = await listPartRes.text();
                        if (listPartCsv && listPartCsv.length > 2) {
                            const listPartLines = listPartCsv.trim().split('\n');
                            listPartLines.forEach(line => {
                                const cells = parseCSVLine(line);
                                const nume = (cells[0] || '').replace(/\r/g, '').trim();
                                if (nume && nume.toLowerCase() !== 'nume') uniqueNames.add(nume);
                            });
                        }
                    }
                } catch (e) {
                    console.warn('‚ö†Ô∏è Sheet lista participan»õi (1372261625):', e.message);
                }
                console.log('‚úÖ Participan»õi unici din sheet 1372261625 col A:', uniqueNames.size);

                // Numere pentru cardurile Antrenament 1/2/3 (din sheet-urile de participare)
                const SHEET_ANTRENAMENT_GIDS = ['138549664', '1187751851', '423881536'];
                const perSheetCounts = [0, 0, 0];
                for (let i = 0; i < SHEET_ANTRENAMENT_GIDS.length; i++) {
                    const gid = SHEET_ANTRENAMENT_GIDS[i];
                    try {
                        const partUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&gid=${gid}&_=${timestamp}`;
                        const partRes = await fetch(partUrl, { mode: 'cors', credentials: 'omit' });
                        if (partRes.ok) {
                            const partCsv = await partRes.text();
                            if (partCsv && partCsv.length > 5) {
                                const partLines = partCsv.trim().split('\n');
                                partLines.forEach(line => {
                                    const cells = parseCSVLine(line);
                                    const nume = [0, 1, 2].map(j => (cells[j] || '').replace(/\r/g, '').trim()).find(s => s.length > 0) || '';
                                    if (nume) perSheetCounts[i]++;
                                });
                            }
                        }
                    } catch (e) {
                        console.warn('‚ö†Ô∏è Sheet antrenament', gid, ':', e.message);
                    }
                }
                console.log('‚úÖ Antrenament 1/2/3:', perSheetCounts);

                // Lista Participan»õi: toate numele unice din 1372261625 col A; date din 87508598 col B unde existƒÉ potrivire. Card = nr total unici (93).
                listParticipanti = [];
                const uniqueNamesSorted = Array.from(uniqueNames).sort();
                for (const nume of uniqueNamesSorted) {
                    const row = rows.find(r => normalizeNume(r[numeIndex]) === normalizeNume(nume));
                    if (row) {
                        const fullDojo = (row[dojoIndex] || '').trim();
                        const parts = fullDojo.split('/').map(p => p.trim());
                        listParticipanti.push({
                            nume: nume,
                            dojo: parts[0] || '',
                            organizatie: parts[1] || '',
                            categorie: (row[copilAdultIndex] || '').trim(),
                            grad: (row[gradIndex] || '').trim()
                        });
                    } else {
                        listParticipanti.push({ nume: nume, dojo: '', organizatie: '', categorie: '', grad: '' });
                    }
                }
                auParticipat = uniqueNames.size;
                console.log('‚úÖ Participan»õi (to»õi din 1372261625 col A):', auParticipat, '| cu date din 87508598:', listParticipanti.filter(p => p.dojo || p.organizatie || p.categorie || p.grad).length);

                // FRAA vs Alte, Copil vs Adult, Mudansha vs Yudansha (din listParticipanti)
                const fraaCount = listParticipanti.filter(p => (String(p.organizatie || '').toUpperCase().includes('FRAA'))).length;
                const alteOrganizatiiCount = listParticipanti.length - fraaCount;
                const copilLista = listParticipanti.filter(p => (String(p.categorie || '').toUpperCase().includes('COPIL'))).length;
                const adultLista = listParticipanti.filter(p => (String(p.categorie || '').toUpperCase().includes('ADULT'))).length;
                const yudanshaLista = listParticipanti.filter(p => {
                    const g = String(p.grad || '').toUpperCase();
                    return g.includes('YUDANSHA') || (g.includes('DAN') && !g.includes('MUDANSHA'));
                }).length;
                const mudanshaLista = listParticipanti.filter(p => {
                    const g = String(p.grad || '').toUpperCase();
                    return g.includes('MUDANSHA') || g.includes('KYU');
                }).length;

                // CalculeazƒÉ statistici
                const stats = {
                    total: inscrisi,
                    inscrisi,
                    auParticipat,
                    fraa: fraaCount,
                    alteOrganizatii: alteOrganizatiiCount,
                    copilLista,
                    adultLista,
                    mudanshaLista,
                    yudanshaLista,
                    antrenament1: perSheetCounts[0],
                    antrenament2: perSheetCounts[1],
                    antrenament3: perSheetCounts[2],
                    copilAdult: {},
                    grade: {},
                    dojos: {},
                    organizatii: {},
                    participare: {}
                };

                console.log(`‚úÖ DescƒÉrcat: ${rows.length} √Ænscri»ôi`);

                // ReseteazƒÉ array-ul de participan»õi
                allParticipants = [];

                rows.forEach(row => {
                    const nume = row[numeIndex] || 'Nespecificat';
                    const category = row[copilAdultIndex] || 'Nespecificat';
                    stats.copilAdult[category] = (stats.copilAdult[category] || 0) + 1;

                    const grad = row[gradIndex] || 'Nespecificat';
                    stats.grade[grad] = (stats.grade[grad] || 0) + 1;

                    const fullDojo = row[dojoIndex] || 'Nespecificat';
                    const parts = fullDojo.split('/').map(p => p.trim());
                    const dojo = parts[0];
                    const org = parts[1] || 'Nespecificat';

                    stats.dojos[dojo] = (stats.dojos[dojo] || 0) + 1;
                    stats.organizatii[org] = (stats.organizatii[org] || 0) + 1;

                    const participareRaw = row[participareIndex] || 'Nespecificat';
                    // DeterminƒÉ tipul: "Toate" sau "Specific"
                    const participareTip = participareRaw.toLowerCase().includes('toate') ? 'Toate antrenamentele' : 'Sesiuni specifice';
                    stats.participare[participareTip] = (stats.participare[participareTip] || 0) + 1;

                    // AdaugƒÉ participantul √Æn array
                    allParticipants.push({
                        nume: nume,
                        dojo: dojo,
                        organizatie: org,
                        categorie: category,
                        grad: grad
                    });
                });

                // PopuleazƒÉ tabelele
                populateParticipantsTable(allParticipants);
                populateListaParticipantiTable(listParticipanti);
                console.log(`üìã Tabel populat cu ${allParticipants.length} √Ænscri»ôi, ${listParticipanti.length} participan»õi unici`);

                // ActualizeazƒÉ cardurile √énscri»ôi / Participan»õi, FRAA vs Alte, antrenament 1/2/3
                document.getElementById('inscrisi').textContent = stats.inscrisi;
                document.getElementById('auParticipat').textContent = stats.auParticipat;
                document.getElementById('fraaCount').textContent = stats.fraa;
                document.getElementById('alteOrganizatiiCount').textContent = stats.alteOrganizatii;
                document.getElementById('copilListaCount').textContent = stats.copilLista;
                document.getElementById('adultListaCount').textContent = stats.adultLista;
                document.getElementById('mudanshaListaCount').textContent = stats.mudanshaLista;
                document.getElementById('yudanshaListaCount').textContent = stats.yudanshaLista;
                document.getElementById('antrenament1').textContent = stats.antrenament1;
                document.getElementById('antrenament2').textContent = stats.antrenament2;
                document.getElementById('antrenament3').textContent = stats.antrenament3;

                // ActualizeazƒÉ cardurile cu anima»õie
                animateValue('totalParticipanti', 0, stats.total, 800);
                animateValue('totalAdulti', 0, stats.copilAdult['Adult'] || 0, 800);
                animateValue('totalCopii', 0, stats.copilAdult['Copil'] || 0, 800);
                animateValue('totalYudansha', 0, stats.grade['Yudansha (grad Dan)'] || 0, 800);
                animateValue('totalMudansha', 0, stats.grade['Mudansha (grad Kyu)'] || 0, 800);

                // ActualizeazƒÉ grafice »ôi salveazƒÉ datele
                updateChartsWithNewData(stats);
                
                // ActualizeazƒÉ display-ul ultimei sincronizƒÉri
                updateLastSyncDisplay();

                btn.textContent = `‚úÖ Sincronizat! (${stats.total} participan»õi)`;
                btn.style.background = 'linear-gradient(135deg, #0f9d58 0%, #16c172 100%)';
                
                setTimeout(() => {
                    btn.textContent = 'üîÑ Sync din Google Sheets';
                    btn.style.background = 'linear-gradient(135deg, #dc2626 0%, #991b1b 100%)';
                    btn.classList.remove('loading');
                    btn.disabled = false;
                }, 2000);

            } catch (error) {
                console.error('Eroare la sincronizare:', error);
                btn.textContent = '‚ùå Eroare la sincronizare';
                btn.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                
                setTimeout(() => {
                    btn.textContent = 'üîÑ Sync din Google Sheets';
                    btn.style.background = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
                    btn.classList.remove('loading');
                    btn.disabled = false;
                }, 3000);
            }
        }

        // Func»õie pentru actualizare grafice cu date noi
        function updateChartsWithNewData(stats) {
            // ActualizeazƒÉ grafic Copil vs Adult
            copilAdultChart.data.labels = Object.keys(stats.copilAdult);
            copilAdultChart.data.datasets[0].data = Object.values(stats.copilAdult);
            copilAdultChart.update('active');
            
            // ActualizeazƒÉ grafic Grade
            gradeChart.data.labels = Object.keys(stats.grade);
            gradeChart.data.datasets[0].data = Object.values(stats.grade);
            gradeChart.update('active');
            
            // ActualizeazƒÉ grafic Dojo-uri
            const dojosSorted = Object.entries(stats.dojos).sort((a, b) => b[1] - a[1]);
            dojoChart.data.labels = dojosSorted.map(d => d[0]);
            dojoChart.data.datasets[0].data = dojosSorted.map(d => d[1]);
            dojoChart.data.datasets[0].backgroundColor = colors.primary.slice(0, dojosSorted.length);
            dojoChart.update('active');
            
            // ActualizeazƒÉ grafic Organiza»õii
            const orgSorted = Object.entries(stats.organizatii).sort((a, b) => b[1] - a[1]);
            organizatieChart.data.labels = orgSorted.map(o => o[0]);
            organizatieChart.data.datasets[0].data = orgSorted.map(o => o[1]);
            organizatieChart.data.datasets[0].backgroundColor = ['#dc2626', '#6b7280', '#4b5563', '#9ca3af'].slice(0, orgSorted.length);
            organizatieChart.update('active');
            
            // ActualizeazƒÉ grafic Participare
            participareChart.data.labels = Object.keys(stats.participare);
            participareChart.data.datasets[0].data = Object.values(stats.participare);
            participareChart.update('active');
            
            // SalveazƒÉ datele √Æn localStorage
            saveData(stats);
            
            console.log('‚úÖ Grafice actualizate cu succes!');
            console.log('üíæ Date salvate pentru refresh-uri viitoare');
        }
    </script>
</body>
</html>

